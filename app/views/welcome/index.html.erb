<!-- <h1>Welcome#index</h1>
<p>Find me in app/views/welcome/index.html.erb</p> -->
<!-- <h1>Hello, Rails!</h1>-->


<!-- 
DOCUMENTATION:- 
Things done:-
1. AJAX working.
2. Event on tab close

Things to do:-
Parse the url(to be taken using document.URL) and send it to the controller.


-->

 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<style type="text/css">
      html { height: 100% }
      body { height: 80%;width: 50%; margin: 0; padding: 0 }
      #map { height: 100% }
    </style>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>iMap</title>
     <!-- <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
    // <script type="text/javascript" src="http://maps.google.com/maps/api/js?key=AIzaSyAR_6EezXheWNmpGyHZVA8Y26WHSRrjNT8"></script>
    // <script type="text/javascript" src="ipmapper.js"></script> -->
    <!--<script type="text/javascript" src="ip2.js"></script>-->
    <%= javascript_include_tag "http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js" %>
    <%= javascript_include_tag "http://maps.google.com/maps/api/js?key=AIzaSyAR_6EezXheWNmpGyHZVA8Y26WHSRrjNT8" %>
    <%= javascript_include_tag 'application' %>
    <script type="text/javascript">
    	function initialize() {
        var mapOptions = {
          
          zoom: 5
        };
        <% @loc.each do |c| %>

 
        IPMapper.initializeMap("map");
        IPMapper.addIPMarker("<%= c %>");
        
        <% end %>
        
      }
      google.maps.event.addDomListener(window, 'load', initialize);
      $(document).ready(function(e){
      	alert(""+document.URL);
      	var url = document.URL;
      	$.ajax({
      		url:'/welcome/list',
      		// method:'POST',
      		// data:({url:url}),
      		datatype:'json',
      		success:function(data){
      			// dparse = $.parseJSON(data);
      			alert("success"+data.length);
      		},
      		error:function(request,status,error){
      			alert("error");
      		}
      	});

      	wireUpEvents();
      	$(window).unload(function(){
      		// var ip = "<%= request.ip %>";
      		// var url = "<%= request.url %>";

      		// return "are u sue??"+ip+" "+url+"";
      		alert("hii");
      		$.ajax({
      			url : '/welcome/tabclose',
      			success:function(data){
      				alert("data");
      			},
      			error:function(error){
      				alert(error);
      			}

      		});
      	});
      });
    </script>
 
    
</head>
<body>
    
    <div id="map" style="height: 500px;"></div>
   <h1>IP: <%= request.ip %></h1>
   <h1>URL: <%= request.url %></h1>
   <h1>Listing ip</h1>
	<ul id="ip_list">
	<% @list.each do |c| %>
	<li><%= c.ip %>
	</li>
	<% end %>
	</ul>
</body>
</html>